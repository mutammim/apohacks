<header class="flex h-screen flex-col items-center text-white">
  <!-- --------------------------------- Top --------------------------------- -->

  <nav class="flex h-24 items-center justify-center">
    <img class="w-48" src="apotitle.png" />
  </nav>

  <!-- -------------------------------- Main --------------------------------- -->

  <div class="flex max-w-2xl flex-1 flex-col py-12">
    <h1 class="font-title text-7xl leading-[0.9] text-purple-300">
      The <span class="text-purple-50">high school hackathon</span> for surviving a <span
        class="text-purple-50">zombie apocalypse.</span
      >
    </h1>

    <p class="font-title mt-6 text-4xl">
      Toronto <span class="text-purple-300">|</span> March 15-17, 2024
    </p>

    <form
      action="https://postal.hackclub.com/subscribe"
      method="POST"
      accept-charset="utf-8"
      class="mt-12 flex overflow-clip bg-dark-bg shadow-[inset_5px_5px_rgba(0,0,0,0.3)]"
      id="email-form"
    >
      <input
        class="font-title flex-1 bg-transparent py-4 pl-6 text-3xl placeholder-white placeholder-opacity-75 focus:outline-none"
        placeholder="you@example.com"
        type="email"
        name="email"
        id="email"
        required
      />

      <input type="hidden" name="list" value="YAbJpY892wYYel892gyGNghouQ" />
      <input type="hidden" name="subform" value="yes" />

      <label
        for="submit"
        id="email-button"
        class="flex cursor-pointer items-center px-4 py-2 sm:px-7 sm:py-3"
      >
        <svg
          class="h-8 w-8 text-white"
          id="todo"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
        >
          <path
            d="M4 11v2h12v2h2v-2h2v-2h-2V9h-2v2H4zm10-4h2v2h-2V7zm0 0h-2V5h2v2zm0 10h2v-2h-2v2zm0 0h-2v2h2v-2z"
            fill="currentColor"
          >
          </path>
        </svg>
        <svg
          class="hidden h-4 w-4 animate-spin text-white sm:h-6 sm:w-6"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          id="loading"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        <svg
          id="done"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          class="hidden h-6 w-6 fill-white"
        >
          <path
            fill-rule="evenodd"
            d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z"
            clip-rule="evenodd"></path>
        </svg>
      </label>
      <input type="submit" name="submit" id="submit" value="" class="w-0" />
    </form>
  </div>

  <!-- --------------------------- Bottom graphic ---------------------------- -->

  <img
    class="max-h-48 w-full rotate-180 object-cover object-bottom drop-shadow-lg"
    src="/top.svg"
    alt="Top Graphic"
  />
</header>

<style>
  header {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E"),
      linear-gradient(#5b21b6 0%, #28184d 100%);
  }
</style>

<script>
  const changingText = document.getElementById("changingText");
  const words = ["fun", "weird", "wacky"];
  let i = 1;

  setInterval(() => {
    changingText.classList.add("motion-safe:-translate-y-3");
    changingText.classList.add("motion-safe:opacity-0");

    setTimeout(() => {
      changingText.innerText = words[i];
      changingText.classList.remove("motion-safe:-translate-y-3");
      changingText.classList.add("motion-safe:translate-y-3");
      i++;
      if (i >= words.length) i = 0;
    }, 200);

    setTimeout(() => {
      changingText.classList.remove("motion-safe:translate-y-3");
      changingText.classList.remove("motion-safe:opacity-0");
    }, 400);
  }, 5000);

  document.getElementById("email-form").addEventListener("submit", (e) => {
    e.preventDefault();

    fetch("/api/lists/subscribe", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        email: (document.getElementById("email") as HTMLFormElement).value,
      }),
    })
      .then((res) => {
        if (res.status === 200) {
          // Success: Switch to done and enable editing
          document.querySelector("#email-button #todo").classList.add("hidden");
          document.querySelector("#email-button #loading").classList.add("hidden");
          document.querySelector("#email-button #done").classList.remove("hidden");
          document.querySelector("#email-form #email").removeAttribute("disabled");
          document.querySelector("#email-form #submit").setAttribute("disabled", "true");
        } else {
          // Failure: Switch to todo, enable editing and submitting
          document.querySelector("#email-button #todo").classList.remove("hidden");
          document.querySelector("#email-button #loading").classList.add("hidden");
          document.querySelector("#email-button #done").classList.add("hidden");
          document.querySelector("#email-form #email").removeAttribute("disabled");
          document.querySelector("#email-form #submit").removeAttribute("disabled");
        }
      })
      .catch(() => {
        // Failure: Switch to todo, enable editing and submitting
        document.querySelector("#email-button #todo").classList.remove("hidden");
        document.querySelector("#email-button #loading").classList.add("hidden");
        document.querySelector("#email-button #done").classList.add("hidden");
        document.querySelector("#email-form #email").removeAttribute("disabled");
        document.querySelector("#email-form #submit").removeAttribute("disabled");
      });

    // Loading: Switch to loading, disable editing and submitting
    document.querySelector("#email-button #todo").classList.add("hidden");
    document.querySelector("#email-button #loading").classList.remove("hidden");
    document.querySelector("#email-form #email").setAttribute("disabled", "true");
    document.querySelector("#email-form #submit").setAttribute("disabled", "true");
  });

  // Reset button when user starts typing
  document.querySelector("#email-form #email").addEventListener("keydown", (e) => {
    document.querySelector("#email-button #todo").classList.remove("hidden");
    document.querySelector("#email-button #loading").classList.add("hidden");
    document.querySelector("#email-button #done").classList.add("hidden");
    document.querySelector("#email-form #submit").removeAttribute("disabled");
  });
</script>
