<header class="flex min-h-screen flex-col items-center text-purple-50">
  <!-- --------------------------------- Top --------------------------------- -->

  <nav class="flex h-32 items-center justify-start pt-6">
    <!-- TODO: Move logo to start, add links at end -->
    <img class="w-56 sm:w-64" src="apotitle.png" />
  </nav>

  <!-- -------------------------------- Main --------------------------------- -->

  <div class="flex flex-col justify-center px-6 pt-8 lg:px-0 lg:pt-20">
    <div class="max-w-2xl">
      <h1
        class="w-[35ch] font-pixel text-xl leading-[0.9] sm:text-2xl lg:-translate-x-14 lg:-translate-y-6 lg:-rotate-6 lg:text-3xl lg:leading-[0.85]"
      >
        What if your ideas weren't restricted to the real world?
      </h1>
      <h1
        class="mt-3 font-pixel text-3xl leading-[0.9] sm:text-4xl lg:mt-5 lg:text-5xl lg:leading-[0.85]"
      >
        The <span class="text-accent2">high school hackathon</span> where you build fun
        tech to survive a <span class="text-accent">zombie apocalypse</span>!
      </h1>
      <!-- TODO: Vertical spacing around here is a little funky! -->
      <p class="mt-4 font-pixel text-2xl sm:mt-6 sm:text-3xl lg:mt-8 lg:text-4xl">
        Toronto <span class="text-accent2">|</span> March 15â€“17, 2024
      </p>
      <p
        class="mt-4 font-pixel text-lg text-purple-200 sm:mt-6 sm:text-xl lg:mt-8 lg:text-2xl"
      >
        Get notified when registrations open!
      </p>
      <form
        action="https://postal.hackclub.com/subscribe"
        method="POST"
        accept-charset="utf-8"
        class="mt-1 flex overflow-clip bg-[#280f61] shadow-[inset_5px_5px_#0c0726] lg:mt-2"
        id="email-form"
      >
        <!-- Coloring for <form> was originally bg-dark-bg shadow-[inset_5px_5px_rgba(0,0,0,0.3)] -->
        <input
          class="flex-1 bg-transparent py-2 pl-4 font-pixel text-xl placeholder-white placeholder-opacity-75 focus:outline-none sm:py-4 sm:pl-6 sm:text-2xl lg:text-3xl"
          placeholder="you@example.com"
          type="email"
          name="email"
          id="email"
          required
        />
        <input type="hidden" name="list" value="YAbJpY892wYYel892gyGNghouQ" />
        <input type="hidden" name="subform" value="yes" />
        <label
          for="submit"
          id="email-button"
          class="flex cursor-pointer items-center px-4 py-2 sm:px-7 sm:py-3"
        >
          <svg
            class="h-6 w-6 text-white sm:h-8 sm:w-8"
            id="todo"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
          >
            <path
              d="M4 11v2h12v2h2v-2h2v-2h-2V9h-2v2H4zm10-4h2v2h-2V7zm0 0h-2V5h2v2zm0 10h2v-2h-2v2zm0 0h-2v2h2v-2z"
              fill="currentColor"
            >
            </path>
          </svg>
          <svg
            id="loading"
            class="hidden h-6 w-6 animate-spin text-white sm:h-8 sm:w-8"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            ><path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M12.9999 2H10.9999V8H12.9999V2ZM12.9999 16H10.9999V22H12.9999V16ZM21.9998 11V13L15.9998 13V11H21.9998ZM7.99963 13V11H1.99963V13L7.99963 13ZM14.9996 6.99997H16.9996V8.99997H14.9996V6.99997ZM18.9995 4.99997H16.9995V6.99997H18.9995V4.99997ZM8.99963 6.99997H6.99963V8.99997H8.99963V6.99997ZM4.99973 4.99997H6.99973V6.99997H4.99973V4.99997ZM14.9996 17H16.9995V18.9999H18.9995V16.9999H16.9996V15H14.9996V17ZM6.99963 16.9999V15H8.99963V17H6.99973V18.9999H4.99973V16.9999H6.99963Z"
              fill="currentColor"></path></svg
          >
          <svg
            id="done"
            class="hidden h-6 w-6 text-white sm:h-8 sm:w-8"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            ><path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M4 4H20H22V6V14H20V6H4V18H12V20H4H2V18V6V4H4ZM8 8H6V10H8V12H10V14H14V12H16V10H18V8H16V10H14V12H10V10H8V8ZM14 18H16V20H14V18ZM18 20V22H16V20H18ZM20 18H18V20H20V18ZM20 18V16H22V18H20Z"
              fill="currentColor"></path></svg
          >
        </label>
        <input type="submit" name="submit" id="submit" value="" class="w-0" />
      </form>
    </div>
  </div>

  <!-- --------------------------- Bottom graphic ---------------------------- -->

  <img
    class="max-h-full w-full grow rotate-180 object-cover object-bottom drop-shadow-lg"
    src="/skyline.svg"
    alt="City skyline"
  />
</header>

<style>
  header {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E"),
      radial-gradient(#5b21b6 0%, #28184d 70%);
  }

  /* Alternative gradients */

  /* radial-gradient(#4a1b9d 0%, #1c1340 70%); */
  /* radial-gradient(#39157f 0%, #120d33 70%); */
  /* radial-gradient(#280f61 0%, #0c0726 70%); */
</style>

<script>
  const changingText = document.getElementById("changingText");
  const words = ["fun", "weird", "wacky"];
  let i = 1;

  setInterval(() => {
    changingText.classList.add("motion-safe:-translate-y-3");
    changingText.classList.add("motion-safe:opacity-0");

    setTimeout(() => {
      changingText.innerText = words[i];
      changingText.classList.remove("motion-safe:-translate-y-3");
      changingText.classList.add("motion-safe:translate-y-3");
      i++;
      if (i >= words.length) i = 0;
    }, 200);

    setTimeout(() => {
      changingText.classList.remove("motion-safe:translate-y-3");
      changingText.classList.remove("motion-safe:opacity-0");
    }, 400);
  }, 5000);

  document.getElementById("email-form").addEventListener("submit", (e) => {
    e.preventDefault();

    fetch("/api/lists/subscribe", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        email: (document.getElementById("email") as HTMLFormElement).value,
      }),
    })
      .then((res) => {
        if (res.status === 200) {
          // Success: Switch to done and enable editing
          document.querySelector("#email-button #todo").classList.add("hidden");
          document.querySelector("#email-button #loading").classList.add("hidden");
          document.querySelector("#email-button #done").classList.remove("hidden");
          document.querySelector("#email-form #email").removeAttribute("disabled");
          document.querySelector("#email-form #submit").setAttribute("disabled", "true");
        } else {
          // Failure: Switch to todo, enable editing and submitting
          document.querySelector("#email-button #todo").classList.remove("hidden");
          document.querySelector("#email-button #loading").classList.add("hidden");
          document.querySelector("#email-button #done").classList.add("hidden");
          document.querySelector("#email-form #email").removeAttribute("disabled");
          document.querySelector("#email-form #submit").removeAttribute("disabled");
        }
      })
      .catch(() => {
        // Failure: Switch to todo, enable editing and submitting
        document.querySelector("#email-button #todo").classList.remove("hidden");
        document.querySelector("#email-button #loading").classList.add("hidden");
        document.querySelector("#email-button #done").classList.add("hidden");
        document.querySelector("#email-form #email").removeAttribute("disabled");
        document.querySelector("#email-form #submit").removeAttribute("disabled");
      });

    // Loading: Switch to loading, disable editing and submitting
    document.querySelector("#email-button #todo").classList.add("hidden");
    document.querySelector("#email-button #loading").classList.remove("hidden");
    document.querySelector("#email-form #email").setAttribute("disabled", "true");
    document.querySelector("#email-form #submit").setAttribute("disabled", "true");
  });

  // Reset button when user starts typing
  document.querySelector("#email-form #email").addEventListener("keydown", (e) => {
    document.querySelector("#email-button #todo").classList.remove("hidden");
    document.querySelector("#email-button #loading").classList.add("hidden");
    document.querySelector("#email-button #done").classList.add("hidden");
    document.querySelector("#email-form #submit").removeAttribute("disabled");
  });
</script>
